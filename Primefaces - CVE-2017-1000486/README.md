# CVE-2017-1000486

This is a modified version of [CVE-2017-1000486 exploit by pimps](https://github.com/pimps/CVE-2017-1000486).

A great analysis of the issue from the security researchers who discovered it can be found [here](https://blog.mindedsecurity.com/2016/02/rce-in-oracle-netbeans-opensource.html)

I have updated only the payload generation part. The exploit can be used also to exploit the Padding Oracle issue (is present), but I prefer PadBuster because is faster.

**Improvements:**

*  **IBM WebSphere exploitation**: in the past during a PT we tried the exploit on some PrimeFaces applications deployed on IBM WebSphere application servers but we found a strange bug that limits the methods that can be called from the EL injection on those environments. I'm not even sure that the issue is only on WebSphere application server, it can be present also with other configurations. My solution is **terrible** and read the output of the command char by char by repeating the read operation for each char, but I didn't find a better solution and **it worked**. With this option you must choose how many chars of the output you want to read and the payload in the request increases in size for each additional char. **Pay attention**: for the bug, I could not call the *Runtime.getRuntime* method directly; I had to use *Runtime.getDeclaredMethods()[0].invoke()* and consequently the payload could require some tuning on the *[0]* array position.
*  **Check options**: I added two check options that can be used to verify the presence of the issue. The first one was supplied by Minded Security in his article and adds a HTTP header, but sometimes it fails. I added a new simpler payload that has a higher success rate.
*  **Simple response obfuscation**: if you want you can apply a simple obfuscation to the output of the command (Base64 of reverse string). I added this option because sometimes WAF could block responses that contain for example the content of the /etc/passwd of other common files exfiltrated through RCE. The exploit automatically applies the reverse transformation before printing the output to the attacker

**Advices:**

*  It's an old exploit but we use it **a lot of times** (tracing and updating Java libraries is not always a simple task and usually those libraries are updated only when a issue has been actively discovered)
*  List of vulnerable PrimeFaces versions that you can find in public resources **are not accurate** and miss some vulnerable versions. If you find a PrimeFaces 5.X or 6.X always do an active check with this exploit and with PadBuster (refer to Minded Security article)
*  I often read that the issues can be exploited only in /javax.faces.resource/dynamiccontent.properties.xhtml or /javax.faces.resource/dynamiccontent.properties.jsf (and I found mitigations that simply restrict access to those resources), but **it is not true**. This issue can be exploited in **all the dynamic resources of PrimeFaces** (examples http://MYURL/MYAPP/**javax.faces.resource**/main/css/perfect-scrollbar.css.xhtml, http://MYURL/MYAPP/**javax.faces.resource**/main/css/perfect-scrollbar.css.jsf, http://MYURL/MYAPP/**javax.faces.resource**/main/css/perfect-scrollbar.css). Always try also on a dynamic resource because mitigations can be in place to protect dynamiccontent.properties endpoints.

**Examples:**

Check if the issue is present on target endpoint (first check) on path */javax.faces.resource/main/css/showcase.css.xhtml*:

	python.exe primefaces_CVE-2017-1000486_fd.py -pt "/javax.faces.resource/main/css/showcase.css.xhtml" -ck 1 http://localhost:8080/showcase-5.2

Check if the issue is present on target endpoint (second check) on default path:

	python.exe primefaces_CVE-2017-1000486_fd.py -ck 2 http://localhost:8080/showcase-5.2

Execute *whoami* command on target application server, obfuscating the response:
	
	python.exe primefaces_CVE-2017-1000486_fd.py -pt "/javax.faces.resource/main/css/showcase.css.xhtml" -c whoami -ob 1 http://localhost:8080/showcase-5.2

Execute *whoami* command on target WebSphere application server, extracting 10 characters of the response:

	python.exe primefaces_CVE-2017-1000486_fd.py -pt "/javax.faces.resource/main/css/showcase.css.xhtml" -c whoami -w 1 -ln 10 http://localhost:8080/showcase-5.2

**Docker**

Build image

        git clone https://github.com/federicodotta/Exploit.git
        cd 'Exploit/Primefaces - CVE-2017-1000486'
        docker build -t primefaces_CVE-2017-1000486 .

Execute **primefaces_CVE-2017-1000486_fd.py** with docker

        docker run --rm -it primefaces_CVE-2017-1000486 [params...]

**Requirements**

Due to `paddingoracle` module, **primefaces_CVE-2017-1000486_fd.py** is limited to Python 2.

**Disclaimer:**

This software has been created purely for the authorized penetration testing and red teaming activies, and is not intended to be used to attack systems except where explicitly authorized. Project maintainers are not responsible or liable for misuse of the software. Use responsibly.
